<!doctype html>
<title>{% block title %}{% endblock %} - Flaskr</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Kanit&family=Montserrat&family=Open+Sans:wght@500&display=swap" rel="stylesheet">
<body>
    <div class="full-body-container">
        <div class="top-text">
            <div class="logo">
                <img src="{{ url_for('static', filename='images/BookBeatsLogo.png') }}">
            </div>
            <p>Create a playlist to listen to while you read</p>
            <div class="input-box" onclick="sendFocus()">
                <label for="book-search">Find Your Book</label>
                <!-- <img src="{{ url_for('static', filename='images/mag.png') }}" /> -->
                <input name='book-search' placeholder="Search for a book title (eg: 'The Great Gatsby')" id="filter-text-val" onkeyup="filterText()">
            </div>
            <div class="search">
                <button>Give me a playlist</button>
            </div>
        </div>
        <div id="answer-box">

        </div>
    </div>

    <script>
        function answerBoxTemplate(title, text) {
            return `<div class=''>
                <h3 class='song-title'>${title}</h3>
                <p class='song-text'>${text}</p>
            </div>`;
        }

        function sendFocus(){
            document.getElementById('filter-text-val').focus()
        }

        // function filterText(){
        //     document.getElementById("answer-box").innerHTML = ""
        //     console.log(document.getElementById("filter-text-val").value)
        //     fetch("/songs?title=" + new URLSearchParams({ title: document.getElementById("filter-text-val").value }).toString())
        //     .then((response) => response.json())
        //     .then((data) => data.forEach(row => {
                
        //         let tempDiv = document.createElement("div")
        //         tempDiv.innerHTML = answerBoxTemplate(row.title,row.descr,row.imdb_rating)
        //         document.getElementById("answer-box").appendChild(tempDiv)
        //     }));

        // }
    
    //     function filterText() {
    //     document.getElementById("answer-box").innerHTML = "";
    //     const title = document.getElementById("filter-text-val").value;
    //     fetch("/songs?title=" + title)
    //         .then(response => response.json())
    //         .then(data => {
    //             data.top_ten_songs.forEach(song => {
    //                 let tempDiv = document.createElement("div");
    //                 tempDiv.innerHTML = answerBoxTemplate(song.title, song.text);
    //                 document.getElementById("answer-box").appendChild(tempDiv);
    //             });
    //         })
    //         .catch(error => {
    //             console.error('Error:', error);
    //         });
    // }

    function filterText() {
    document.getElementById("answer-box").innerHTML = "";
    const title = document.getElementById("filter-text-val").value;
    fetch("/songs?title=" + title)
        .then(response => response.json())
        .then(data => {
            data.top_ten_songs.forEach(song => {
                // Access title and text using appropriate keys
                let title = song.title;
                let text = song.text;

                let tempDiv = document.createElement("div");
                tempDiv.innerHTML = answerBoxTemplate(title, text);
                document.getElementById("answer-box").appendChild(tempDiv);
            });
        })
        .catch(error => {
            console.error('Error:', error);
        });
}

</script>
</body>